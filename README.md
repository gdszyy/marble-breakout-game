# 弹珠编程打砖块 - 炼金术士守城

一个创新的弹珠打砖块游戏，结合了编程机制、物理模拟和策略元素。玩家通过编程弹珠的行为来击碎砖块，同时管理能量系统和收集模块奖励。

## 🎮 游戏特色

**弹珠编程打砖块 - 炼金术士守城**是一款融合了多种创新玩法的休闲策略游戏。游戏的核心在于**子弹编程系统**，玩家可以通过组合不同的模块来定制弹珠的行为，创造出独特的攻击方式。游戏采用基于 PixiJS 的高性能渲染引擎和 Matter.js 物理引擎，提供流畅的游戏体验和真实的物理反馈。

### 核心玩法

游戏的主要玩法围绕**缓冲阵列系统**展开。玩家发射弹珠击碎砖块，弹珠在下落过程中会碰撞缓冲器收集材料，这些材料会转化为能量。玩家需要合理管理能量，在材料收集和攻击发射之间找到平衡。能量系统的设计非常巧妙：空槽充能效率为100%，而满槽效率降低到80%，这鼓励玩家及时使用能量而不是无限囤积。

**子弹编程系统**是游戏的核心创新点。玩家可以将基础子弹（普通、穿透、AOE）与修饰模块（反弹+1、散射+1、齐射+1、碰撞触发等）组合，创造出多样化的攻击方式。每个模块都会消耗能量，发射消耗的计算公式为：模块数量 × 10能量。这种设计让玩家需要在强大的攻击和能量消耗之间做出权衡。

游戏还引入了**奖励缓冲器**机制。在缓冲阵列中会随机出现金色的奖励缓冲器，弹珠击中后可以触发转盘抽奖，获得稀有模块。奖励缓冲器的位置设计得非常刁钻，触发概率控制在5-12%之间，增加了游戏的挑战性和趣味性。

### 技术亮点

游戏采用**事件驱动架构**，通过事件管理器切换不同的游戏阶段（砖块生成 → 子弹装填 → 玩家行动 → 砖块行动），实现流畅的回合制节奏。渲染系统基于 **PixiJS 8.14.3**，提供高性能的2D图形渲染。物理系统使用 **Matter.js 0.20.0**，实现真实的碰撞检测和物理模拟。动画效果由 **GSAP 3.13.0** 和 **Framer Motion 12.23.22** 驱动，带来流畅的视觉体验。

游戏完全支持移动端操作，经过专门的触控优化，分离了移动和瞄准操作，提供了更好的移动端游戏体验。UI系统使用 **Radix UI** 组件库，提供了现代化的用户界面。

## 🚀 快速开始

### 在线体验

访问游戏网页：https://3000-ioioobf0wx6evuy8xedmu-668bb065.manusvm.computer

（注意：这是临时部署链接，建议按照下面的说明进行正式部署）

### 本地运行

#### 环境要求
- Node.js 22.x
- pnpm 10.x

#### 安装依赖
```bash
pnpm install
```

#### 启动开发服务器
```bash
pnpm dev
```
开发服务器将在 http://localhost:3000 启动

#### 构建生产版本
```bash
pnpm build
```

#### 启动生产服务器
```bash
pnpm start
```

## 📖 游戏说明

### 基本操作
- **鼠标/触摸**：点击游戏区域发射弹珠
- **重新开始**：重置游戏状态
- **生成砖块**：手动生成新的砖块
- **砖块下落**：让砖块向下移动一行

### 游戏目标
- 击碎所有砖块获得分数
- 收集材料转化为能量
- 通过编程弹珠行为创造强大攻击
- 触发奖励缓冲器获得稀有模块
- 在砖块到达底部前守住防线

### 能量系统
- 弹珠击中缓冲器收集材料
- 材料自动转化为能量
- 空槽充能效率：100%
- 满槽充能效率：80%
- 发射消耗：模块数量 × 10能量

### 子弹编程
通过组合不同模块创造独特攻击：

**基础子弹**
- 普通弹：标准伤害
- 穿透弹：可穿透多个砖块
- AOE弹：范围伤害

**修饰模块**
- 反弹+1：增加一次反弹次数
- 散射+1：分裂成多个弹珠
- 齐射+1：同时发射多个弹珠
- 碰撞触发：碰撞时触发特殊效果

## 🛠️ 技术栈

### 前端
- **框架**: React 18.3.1 + TypeScript 5.6.3
- **游戏引擎**: PixiJS 8.14.3
- **物理引擎**: Matter.js 0.20.0
- **动画**: GSAP 3.13.0, Framer Motion 12.23.22
- **UI组件**: Radix UI
- **状态管理**: React Context + Hooks
- **路由**: Wouter 3.7.1
- **样式**: Tailwind CSS 4.1.14

### 构建工具
- **构建**: Vite 7.1.9
- **包管理**: pnpm 10.4.1
- **类型检查**: TypeScript 5.6.3

### 后端
- **服务器**: Express 4.21.2
- **运行时**: Node.js 22.x

## 📁 项目结构

```
marble-breakout-game/
├── client/                    # 前端代码
│   ├── src/
│   │   ├── components/        # React组件
│   │   ├── game/              # 游戏核心逻辑
│   │   │   ├── engine/        # 游戏引擎
│   │   │   ├── physics/       # 物理系统
│   │   │   ├── renderer/      # 渲染系统
│   │   │   └── modules/       # 模块系统
│   │   ├── contexts/          # React上下文
│   │   ├── hooks/             # 自定义Hooks
│   │   ├── pages/             # 页面组件
│   │   ├── types/             # TypeScript类型
│   │   └── lib/               # 工具函数
│   ├── public/                # 静态资源
│   │   └── game_assets/       # 游戏资源
│   └── index.html             # HTML模板
├── server/                    # 后端代码
│   └── index.ts               # Express服务器
├── shared/                    # 共享代码
│   └── const.ts               # 共享常量
├── DEPLOYMENT.md              # 部署说明
├── README_PSEUDOCODE.md       # 伪代码文档说明
├── PSEUDOCODE_*.md            # 详细伪代码文档
└── todo.md                    # 任务清单
```

## 🎯 已实现功能

- ✅ 基础游戏循环系统
- ✅ 子弹编程模块系统
- ✅ 缓冲阵列和弹珠掉落系统
- ✅ 能量系统
- ✅ 模块图标渲染系统
- ✅ 子弹槽命名系统
- ✅ 移动端触控优化
- ✅ 玩家阶段交互优化（分离移动和瞄准）
- ✅ 设置页面和配置系统
- ✅ 弹珠发射模式（自动/手动切换）
- ✅ 奖励缓冲器系统
- ✅ 转盘式抽奖UI
- ✅ 模块池和库存系统
- ✅ 编辑器模块库存支持

## 🔮 待优化功能

- ⏳ 奖励缓冲器触发概率测试和调整
- ⏳ 子弹编辑器拖拽排序功能
- ⏳ 砖块下落动画优化
- ⏳ 模块说明页面
- ⏳ 能量上限显示优化
- ⏳ 完整游戏流程测试
- ⏳ 性能优化和代码清理

## 📚 文档

- [部署说明](DEPLOYMENT.md) - 详细的部署指南
- [伪代码文档](README_PSEUDOCODE.md) - 游戏设计和实现的伪代码
- [任务清单](todo.md) - 开发任务和进度

## 🚀 部署

### 推荐部署方式

#### Vercel（推荐）
1. Fork 本仓库到你的 GitHub 账号
2. 在 Vercel 导入项目
3. 构建命令：`pnpm build`
4. 输出目录：`dist/public`
5. 自动部署完成

#### Netlify
1. 连接 GitHub 仓库
2. 构建命令：`pnpm build`
3. 发布目录：`dist/public`
4. 部署

#### GitHub Pages
```bash
# 构建项目
pnpm build

# 部署到 gh-pages 分支
# （需要配置 GitHub Pages 指向 gh-pages 分支）
```

详细部署说明请参考 [DEPLOYMENT.md](DEPLOYMENT.md)

## 🎨 扩展方向

游戏设计具有很强的可扩展性，可以在以下方向进行扩展：

- **更多模块类型**：追踪、分裂、冰冻、毒性、链式反应等
- **更多缓冲器模板**：金字塔、螺旋、随机、动态变化等
- **砖块类型**：装甲砖块、爆炸砖块、分裂砖块、Boss砖块等
- **进阶系统**：模块升级、成就系统、商店、天赋树等
- **视觉效果**：粒子效果、屏幕震动、慢动作、光影效果等
- **难度系统**：简单/普通/困难/地狱模式
- **多人模式**：合作模式、对战模式、全球排行榜等

## 📄 许可证

MIT License - 详见 [LICENSE](LICENSE) 文件

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

## 📧 联系方式

如有问题或建议，请在 GitHub 仓库提交 Issue。

---

**享受游戏！** 🎮✨
