# 弹珠编程打砖块游戏 - TODO

## 已完成（继承自之前的工作）
- [x] 基础游戏循环系统
- [x] 子弹编程模块系统
- [x] 缓冲阵列和弹珠掉落系统
- [x] 能量系统
- [x] 模块图标渲染系统
- [x] 子弹槽命名系统
- [x] 移动端触控优化
- [x] 优化玩家阶段交互(分离移动和瞄准操作)
- [x] 创建设置页面组件
- [x] 添加弹珠发射模式配置(自动/手动切换)
- [x] 实现手动模式弹珠发射逻辑
- [x] 设计奖励缓冲器数据结构和类型定义
- [x] 为三种模板配置奖励缓冲器固定位置
- [x] 实现奖励缓冲器的渲染(金色外观+礼物盒图标+闪烁特效)
- [x] 实现弹珠与奖励缓冲器的碰撞检测
- [x] 创建转盘式抽奖UI组件
- [x] 实现转盘旋转动画和抽奖逻辑
- [x] 实现模块池系统(直接添加到库存)
- [x] 实现抽奖结果添加到模块库存
- [x] 编辑器已支持使用模块库存

## 待完成
- [ ] 迁移现有游戏代码到新项目
- [ ] 配置Git仓库并推送初始代码
- [ ] 测试奖励缓冲器触发概率
- [ ] 调整奖励缓冲器位置确保刁钻性(5-12%触发率)
- [ ] 奖励系统平衡性测试和调整
- [ ] 子弹编辑器拖拽排序功能
- [ ] 砖块下落动画优化
- [ ] 模块说明页面
- [ ] 能量上限显示优化
- [ ] 完整测试游戏流程
- [ ] 性能优化和代码清理

## 重构任务
- [ ] 提取核心游戏逻辑
- [ ] 重构Game组件完整实现
- [ ] 确保所有导入路径正确
- [ ] 测试游戏基本运行

## 伪代码记录任务
- [x] 记录游戏核心架构和数据结构
- [x] 记录游戏引擎和事件系统逻辑
- [x] 记录物理系统和碰撞检测逻辑
- [x] 记录UI渲染和交互逻辑
- [x] 整理完整的伪代码文档

## PixiJS实现任务
- [x] 查看PixiJS实现方案文档
- [x] 解压并整理游戏资源
- [x] 配置PixiJS开发环境
- [x] 实现游戏核心引擎
- [x] 实现物理和碰撞系统
- [x] 实现渲染系统
- [x] 实现UI和交互
- [x] 测试和优化
- [x] 推送到GitHub

## 完整游戏实现任务（基于设计文档）
- [x] 实现事件管理器（四阶段切换）
- [x] 实现砖块生成阶段
- [x] 实现子弹装填阶段
- [x] 实现弹珠物理系统（重力、反弹、碰撞）
- [x] 实现缓冲器系统（普通+奖励）
- [ ] 实现奖励缓冲器闪烁效果
- [ ] 实现转盘抽奖系统
- [x] 实现子弹编程处理器
- [x] 实现能量计算器
- [x] 实现模块库存系统
- [x] 实现子弹编辑器UI
- [x] 实现瞄准轨迹预测
- [ ] 实现手动/自动弹珠发射模式
- [ ] 实现子弹槽切换
- [x] 实现砖块行动阶段
- [x] 集成游戏资源图片
- [ ] 添加视觉特效（发光、粒子）
- [ ] 优化移动端触控
- [ ] 完善UI布局

## UI完善任务
- [x] 完善子弹编辑器拖拽排序功能
- [x] 添加模块详细信息展示
- [x] 优化能量条显示
- [x] 添加模块组合预览效果
- [x] 移除游戏顶部标题和说明
- [x] 优化按钮布局
- [x] 改善子弹槽显示样式

## 子弹编辑器功能修复
- [x] 修复模块库存初始化问题
- [x] 修复模块添加功能
- [x] 确保模块可以正常添加到配置槽
- [x] 测试模块添加和移除流程

## 子弹编辑器功能修复（第二轮）
- [x] 修复清空按钮功能（返还模块到库存）
- [x] 实现模块拖拽排序功能
- [x] 测试清空和拖拽流程

## Dialog组件修复
- [x] 修复DialogOverlay的forwardRef警告
- [x] 测试Dialog组件正常工作

## 拖拽交互优化
- [x] 修复拖拽导致组件虚空增减的bug
- [x] 实现拖拽预览效果（半透明）
- [x] 实现所见即所得的拖拽体验
- [x] 测试拖拽功能稳定性

## 子弹编辑器交互优化
- [x] 修复清空按钮响应延迟问题
- [x] 修复添加模块的延迟问题
- [x] 添加拖拽平滑过渡动画
- [x] 优化模块添加和移除的动画效果
- [x] 测试所有交互流畅度

## 场景系统重构
- [x] 设计场景1（战斗场景）和场景2（装填场景）
- [x] 实现阶段标题提示（1秒显示）
- [x] 实现石板抽屉动画切换到装填场景
- [x] 修复自动进行的回合制问题
- [x] 确保严格回合制，需要手动点击下一阶段
- [x] 测试场景切换流畅度

## 场景切换修复
- [x] 修复装填场景结束后未切换回战斗场景的问题
- [x] 确保场景切换与阶段切换同步
- [x] 测试完整的四阶段场景切换流程

## 场景切换优化
- [x] 修复阶段标题显示超过1秒不消失的问题
- [x] 修复石板抽屉遮挡按钮和状态信息的问题
- [x] 确保石板只遮挡游戏画布区域
- [x] 测试优化后的场景切换效果

## 场景系统重新设计
- [x] 分离战斗场景和装填场景的渲染逻辑
- [x] 在装填场景中渲染缓冲器阵列
- [x] 在装填场景中渲染弹珠掉落动画
- [x] 实现石板滑动切换两个场景
- [ ] 测试场景切换效果

## 场景切换优化（移除石板动画）
- [x] 移除装填场景的石板抽屉动画效果
- [x] 实现战斗场景和装填场景的直接切换
- [x] 测试场景切换效果

## 修复子弹槽显示问题
- [x] 修复装填场景中子弹槽不显示的问题
- [x] 确保子弹槽在所有场景中都可见
- [x] 测试场景切换时子弹槽的显示状态

## 实现子弹槽点击切换功能
- [x] 在画布点击事件中添加子弹槽区域检测
- [x] 实现点击槽位B/C切换当前选中槽位
- [x] 更新选中槽位的黄色边框显示
- [x] 测试槽位切换功能

## 实现游戏画布自适应
- [x] 计算页面可用空间
- [x] 根据宽高比自动调整画布尺寸
- [x] 添加窗口resize事件监听
- [x] 测试不同屏幕尺寸的显示效果

## 修复program访问错误
- [x] 定位访问 slot.program的代码位置
- [x] 添加slot存在性检查
- [x] 测试修复后的功能

## 修复slotId解析错误
- [x] 检查BulletEditor传递的slotId格式
- [x] 修复handleUpdateSlot中的slotId解析逻辑
- [x] 测试子弹编程界面的模块添加功能

## 修复自适应缩放问题
- [x] 移除画布的transform缩放
- [x] 使用CSS布局让画布和按钮自然适应容器
- [x] 确保按钮位置和画布匹配
- [x] 测试不同屏幕尺寸的显示效果

## 移除玩家移动功能
- [x] 移除键盘事件监听（左右方向键）
- [x] 固定玩家三角形位置在底部中央
- [x] 移除玩家移动相关的状态和逻辑
- [x] 测试瞄准和射击功能是否正常

## 实现玩家阶段瞄准线
- [x] 在鼠标移动时记录鼠标位置
- [x] 判断当前是否为PLAYER_ACTION阶段
- [x] 绘制从玩家三角形到鼠标位置的瞄准线
- [x] 测试瞄准线显示效果
